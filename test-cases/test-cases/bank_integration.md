
---

##

# Тест-кейсы: интеграция с банками через REST API

> Сценарии обработки ошибок при наложении ареста на счёт должника.

## Сценарии таймаута

| ID | Сценарий | Эмуляция | Ожидаемый результат | Приоритет |
|----|----------|----------|---------------------|-----------|
| BANK-01 | Таймаут 15 сек | Charles Proxy: Breakpoint → прервать на 15 сек | Статус = `в обработке` | Критичный |
| BANK-02 | Таймаут 30 сек | Charles Proxy: Throttling → 0.1 Kbps | Спиннер 30 сек → ошибка → кнопка «Повторить» | Критичный |
| BANK-03 | Таймаут 60 сек | Charles Proxy: Breakpoint → прервать на 60 сек | Статус = `ошибка связи` + возможность повтора | Высокий |

## Сценарии ошибок банка

| ID | Код ошибки | Тело ответа | Ожидаемый результат | Приоритет |
|----|------------|-------------|---------------------|-----------|
| BANK-04 | 400 Bad Request | `{"error": "invalid_inn"}` | Ошибка: «Неверный ИНН» | Высокий |
| BANK-05 | 404 Not Found | — | Ошибка: «Счёт не найден» | Высокий |
| BANK-06 | 500 Internal Error | — | Спиннер 5 сек → «Ошибка банка» → кнопка «Повторить» | Критичный |
| BANK-07 | 502 Bad Gateway | — | То же, что 500 | Высокий |
| BANK-08 | 504 Gateway Timeout | — | То же, что таймаут 30 сек | Высокий |

## Позитивные сценарии

| ID | Сценарий | Статус ответа | Ожидаемый результат |
|----|----------|---------------|---------------------|
| BANK-09 | Арест успешен | 200 OK + `{"status": "completed"}` | Статус = `арест наложен`, уведомление должнику |
| BANK-10 | Арест в обработке | 202 Accepted + `{"status": "processing"}` | Статус = `в обработке`, опрос статуса каждые 10 сек |

## Как эмулировать в Charles Proxy

### Шаг 1: Настроить прокси
1. Установить [Charles Proxy](https://www.charlesproxy.com)
2. Включить **Proxy → macOS Proxy** (или Windows Proxy)
3. В браузере/приложении настроить прокси: `localhost:8888`

### Шаг 2: Эмуляция таймаута через Breakpoint
1. **Proxy → Breakpoints Settings** → добавить `*arrest*` (URL запроса)
2. Отправить запрос на арест → Charles остановит его
3. Подождать 15/30/60 сек → нажать **Abort** (не **Execute**!)
4. Проверить статус операции в интерфейсе

### Шаг 3: Эмуляция ошибки 500 через Map Local
1. **Tools → Map Local** → добавить правило для эндпоинта банка
2. Создать локальный файл `500.json`:
```json
{
  "error": "internal_server_error",
  "message": "Bank service unavailable"
}
